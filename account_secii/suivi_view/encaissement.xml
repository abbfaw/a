<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <data>

        <!-- Vue Liste pour purchase-->
        <record id="encaissement_purchase_list" model="ir.ui.view">
            <field name="name">purchase.encaissement.list</field>
            <field name="model">purchase.encaissement</field>
            <field name="arch" type="xml">
                <tree string="Encaissement">
                    <header>
                        <button name="update_exist_vendor_type" type="object" string="update vendor"/>
                    </header>
                    <field name="date" width="1"/>
                    <field name="num_seq" string="Réference" width="1"/>
                    <field name="create_uid" width="1" optional="hide"/>
                    <field name="libele_op" width="1"/>
                    <field name="partner_id" width="1"/>
                    <field name="amount_devise" width="1" optional="show"/>
                    <field name="company_currency_id" invisible="1"/>
                    <field name="amount_total_signed" string="Montant" width="1"  sum="Montant"
                           class="oe_inline" widget='monetary' options="{'currency_field': 'company_currency_id'}" decoration-bf="True"/>
                    <field name="somme_paye" string="Montant" width="1" invisible="1"/>
                    <field name="status" widget="badge" string="Statut" decoration-info="status == 'brouillon'"
                           decoration-success="status == 'paye'" />
                </tree>
            </field>
        </record>

        <!-- Vue Form pour purchase-->
        <record id="encaissement_purchase_form" model="ir.ui.view">
            <field name="name">purchase.encaissement.form</field>
            <field name="model">purchase.encaissement</field>
            <field name="arch" type="xml">
                <form>
                    <header style="margin-top:25px;">
                        <field name="status" widget="statusbar"/>
                        <button name="put_validate" type="object" string="Payé"
                                class="oe_highlight"
                                attrs="{'invisible':[('status','in',('paye'))]}"
                                />
                        <button name="put_draft" type="object" string="Remettre en brouillon"
                                class="oe_highlight"
                                attrs="{'invisible':[('status','not in',('paye'))]}"/>
                    </header>
                    <sheet>
                        <widget name="web_ribbon" text="PAYE" bg_color="bg-success"
                                attrs="{'invisible': [('status', '!=', 'paye')]}"
                                tooltip="cette transaction est encaissée"/>
                        <group>
                            <group>
                                <field name="partner_type" invisible="1"/>
                                <field name="num_seq" string="Réference" readonly="1"/>
                                <!--                                <field name="sh_rec" invisible="1"/>-->
                                <field name="date" attrs="{'readonly':[('status','!=',('brouillon'))]}"/>
                                <field name="partner_id"
                                       attrs="{'readonly':[('status','!=',('brouillon'))],'invisible':[('partner_type','=','customer')]}"
                                       options="{'no_create': True}"/>
                                <field name="partner_id" string="Client"
                                       attrs="{'readonly':[('status','!=',('brouillon'))],'invisible':[('partner_type','=','vendor')]}"
                                       options="{'no_create': True}"/>
                                <field name="currency_id" required="1" string="Devise" attrs="{'readonly':[('status','!=',('brouillon'))]}"/>
                                <field name="edit_rate" readonly="1"  force_save="1" attrs="{'invisible':[('company_curreny_bool','=',True)]}"/>
                                <field name="company_curreny_bool" invisible="1"/>
                                <field name="libele_op" attrs="{'readonly':[('status','!=',('brouillon'))]}"/>

                            </group>
                            <group >
                                <field name="payment_method" attrs="{'readonly':[('status','!=',('brouillon'))]}"/>
                                <field name="somme_paye" string="Montant" attrs="{'readonly':[('status','!=',('brouillon'))]}"/>
                                <field name="note" attrs="{'readonly': [('status', '!=', 'brouillon')]}"/>
                            </group>

                        </group>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" groups="base.group_user"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <!--Search view pour les purchase group by -->
        <record id="school_student_search" model="ir.ui.view">
            <field name="name">purchase.encaissement.search</field>
            <field name="model">purchase.encaissement</field>
            <field name="arch" type="xml">
                <search>
                    <field name="partner_id"/>
                    <separator orientation="vertical"/>
                    <group expand="0" string="Group By">
                        <filter string="Semaine en cours"
                                name="filtre_semaine"
                                domain="[('date', '>=', (datetime.datetime.combine(context_today() + relativedelta(weeks=-1,days=1,weekday=0), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d %H:%M:%S')),
                                ('date', '&lt;', (datetime.datetime.combine(context_today() + relativedelta(days=1,weekday=0), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d %H:%M:%S'))]"
                        />
                        <filter string="Fournisseurs" name="partner_id" domain="[]" context="{'group_by': 'partner_id'}"/>
                    </group>

                </search>
            </field>
        </record>


        <!-- actions opening views on models -->
        <record id="encaissement_purchase_action_1" model="ir.actions.act_window">
            <field name="name">Paiements Fournisseurs</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">purchase.encaissement</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="encaissement_purchase_list"/>
            <field name="target">current</field>
            <field name="domain">[('partner_type','=','vendor')]</field>
            <field name="context">{'default_partner_type': 'vendor'}</field>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Créer un nouveau encaissement
                </p>
            </field>
        </record>

        <record id="encaissement_sale_action_client" model="ir.actions.act_window">
            <field name="name">Paiements Clients</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">purchase.encaissement</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('partner_type','=','customer')]</field>
            <field name="context">{'default_partner_type': 'customer'}</field>
            <field name="view_id" ref="encaissement_purchase_list"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">
                    Créer un nouveau paiement
                </p>
            </field>
        </record>


        <!--Sous Menus -->
        <!--        paiement additionnel fournisseur-->
        <!--masque la vue du champs encaissement pour tous ceux qui ne sont pas dans les groupes-->
        <menuitem name="Paiements additionnels"
                  id="enc_purchase"
                  parent="account.menu_finance_payables"
                  sequence="21"
                  action="encaissement_purchase_action_1"
        />
<!--        paiement additionnel clients-->
        <menuitem name="paiements additionnels"
                  id="commerciaux_secii"
                  parent="account.menu_finance_receivables"
                  sequence="16"
                  action="encaissement_sale_action_client"/>

    </data>
</odoo>